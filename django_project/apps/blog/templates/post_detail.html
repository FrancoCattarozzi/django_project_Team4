{% extends 'base.html' %}

{% load static %}

{% block content %}


    {% if post.imagen %}
    <div class="text-center mb-4">
        <img src="{{post.imagen.url}}" class="img-fluid" alt=''>
    </div>
    {% endif %}

    <h1 class="mb-2">{{ object.titulo }}</h1>
    <h6 class="text-muted mb-4">{{ object.fecha_creacion }}</h6>
    <p class="mb-4">{{ object.contenido }}</p>
    <br>
    <h3>Ingredientes necesarios</h3>
    <p class="mb-4">{{ object.receta }}</p>
    <br>
    <h3>Instrucciones</h3>
    <p class="mb-4">{{ object.instrucciones }}</p>

    {% if user.is_authenticated %}
        {% if user.is_staff or user == post.autor %}
        <div class="mb-4 d-flex gap-2">
            <a href="{% url 'post_delete' post.pk %}" class="btn btn-light">Eliminar Receta</a>
            <a href="{% url 'post_update' post.pk %}" class="btn btn-light">Modificar Receta</a>
        </div>
        {% endif %}
    {% endif %}

    <p class="text-muted">Nota creada por {{ object.autor }}</p>

    <form action="{% url 'like_post' post.pk %}" method="POST">
        {% csrf_token %}
        {% if user in post.likes.all %}
            <button type="submit" class="btn btn-light">üíî Dejar de recomendar ({{ post.total_likes }})</button>
        {% else %}
            <button type="submit" class="btn btn-light">‚ù§Ô∏è Recomendar ({{ post.total_likes }})</button>
        {% endif %}
    </form>

    <hr>

    <h2 class="mb-3">Comentarios</h2>

    {% if user.is_authenticated %}
        <form action="{% url 'comentar_post' post.pk %}" method="post" class="mb-4">
            {% csrf_token %}
            <div class="row">
                <div class="col-12 col-md-6 col-lg-4 mb-4">
                    {{ form.contenido }}
                </div>
            </div>
            <button type="submit" class="btn btn-light">Comentar</button>
        </form>
    {% endif %}

    {% for comentario in post.comentarios.all %}
    <div class="mb-3 p-3 border rounded">
        <div>
            <div class="d-flex justify-content-start">
                <p class="m-1">{{ comentario.autor }}</p>
                <p class="m-1"> | </p>
                <p class="text-muted m-1">{{ comentario.fecha_creacion }}</p>
            </div>
            <h5>{{ comentario.contenido}}</h5> <br>
        </div>

        {% if user.is_authenticated %}
            {% if user.is_staff or user == post.autor %}  
            <div class="d-flex gap-2">
                <a href="{% url 'comentario_delete' comentario.id %}" class="btn btn-light">Eliminar comentario</a>
                <a href="{% url 'comentario_update' comentario.id %}" class="btn btn-light">Modificar comentario</a>
            </div>
            {% endif %}
        {% endif %}
    </div>
        
    {% endfor %}

{% endblock %}